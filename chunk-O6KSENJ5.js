import{a as me}from"./chunk-EPDUI77S.js";import{a as J}from"./chunk-MP4LVO4K.js";import"./chunk-4QRD2FVP.js";import{a as ge}from"./chunk-JBVRINQ4.js";import{c as de}from"./chunk-YNROWP4N.js";import"./chunk-SCRHCU3P.js";import{O as se,b as K,d as Q,e as Y,g as Z,i as ee,k as te,l as ne,m as ie,n as oe,o as re,p as le,q as ae,s as ce,t as P}from"./chunk-EVUFTYVY.js";import{$a as h,Aa as d,Ab as X,Db as $,Eb as q,Ga as n,Gb as T,Ha as i,Ia as u,K as V,La as D,Na as f,O as z,Oa as g,P as B,Tb as H,U as _,V as C,Za as l,_a as E,bb as b,cb as M,db as v,fb as R,ha as L,ib as W,ja as s,jb as S,ka as O,kb as w,lb as G,w as A,wa as x,y as N,yb as U,zb as j}from"./chunk-C5J53P3W.js";import{h as fe}from"./chunk-K4ALXBGI.js";var y=fe(ge());var _e=(o,m,e)=>({"text-success":o,"text-warning":m,"text-danger":e});function Ce(o,m){if(o&1&&u(0,"img",42),o&2){let e=g().$implicit;d("src",e.foto,L)}}function xe(o,m){o&1&&(n(0,"span"),l(1," \u{1F4E6} "),i())}function be(o,m){if(o&1){let e=D();n(0,"tr",33),f("click",function(){let t=_(e).$implicit,c=g(2);return C(c.addProductToCart(t))}),n(1,"td",34),x(2,Ce,1,1,"img",35)(3,xe,2,0,"span",23),i(),n(4,"td",36)(5,"div",37),l(6),i(),n(7,"div",38)(8,"small",39),l(9),i(),n(10,"small",40),l(11),i()()(),n(12,"td",41),l(13),S(14,"currency"),i()()}if(o&2){let e=m.$implicit;s(2),d("ngIf",e.foto&&e.foto!=="NOT-IMAGE"),s(),d("ngIf",!e.foto||e.foto==="NOT-IMAGE"),s(3),E(e.descripcion),s(3),h("C\xF3digo: ",e.codigo,""),s(),d("ngClass",W(9,_e,e.stock>5,e.stock>0&&e.stock<=5,e.stock===0)),s(),h(" Stock: ",e.stock," "),s(2),h(" ",w(14,7,e.pvp)," ")}}function Me(o,m){if(o&1&&(n(0,"div",19)(1,"table",31)(2,"tbody"),x(3,be,15,13,"tr",32),i()()()),o&2){let e=g();s(3),d("ngForOf",e.products)}}function ve(o,m){o&1&&(n(0,"div",43),l(1," No hay productos para mostrar "),i())}function Se(o,m){if(o&1){let e=D();n(0,"tr")(1,"td",36),l(2),i(),n(3,"td")(4,"input",44),v("ngModelChange",function(t){let c=_(e).$implicit;return M(c.cantidad,t)||(c.cantidad=t),C(t)}),f("ngModelChange",function(){_(e);let t=g();return C(t.recalculate())}),i()(),n(5,"td"),l(6),S(7,"currency"),i(),n(8,"td",45),l(9),S(10,"currency"),i(),n(11,"td")(12,"button",46),f("click",function(){let t=_(e).index,c=g();return C(c.removeItem(t))}),u(13,"i",47),i()()()}if(o&2){let e=m.$implicit;s(2),E(e.descripcion),s(2),b("ngModel",e.cantidad),s(2),E(w(7,4,e.pvp)),s(3),h(" ",w(10,6,e.pvp*e.cantidad)," ")}}function ye(o,m){o&1&&(n(0,"tr")(1,"td",48),l(2," No hay productos agregados "),i()())}var k=(()=>{class o{constructor(e,r){this.fb=e,this.productService=r,this.cliente={nombre:"",celular:"",rol:"cliente"},this.allProducts=[],this.products=[],this.cartItems=[],this.MAX_RESULTS=6}ngOnInit(){this.formGroup=this.fb.group({searchControl:[""]}),this.getAllProducts(),this.formGroup.get("searchControl").valueChanges.pipe(A(300),N()).subscribe(e=>{this.applyFilter(e)})}confirmVenta(){y.default.Confirm.show("Confirmar venta","\xBFSeguro deseas realizar esta venta?","S\xED, vender","Cancelar",()=>{this.realizarVenta()},()=>{},{titleColor:"#ffffff",messageColor:"#ffffff",backgroundColor:"#1e1e2f",okButtonBackground:"#28a745",cancelButtonBackground:"#dc3545",okButtonColor:"#ffffff",cancelButtonColor:"#ffffff",borderRadius:"12px",width:"360px"})}realizarVenta(){y.default.Loading.standard("Procesando venta..."),setTimeout(()=>{y.default.Loading.remove(),y.default.Notify.success("Venta realizada con \xE9xito"),this.clearCart(),this.cliente={nombre:"",celular:"",rol:"cliente"},this.formGroup.get("searchControl")?.setValue("")},800)}getAllProducts(){this.productService.getProducts(1,1e3,"","descripcion","asc").subscribe({next:e=>{this.allProducts=e.items||[],this.showDefaultProducts()}})}applyFilter(e){let r=this.formGroup.get("searchControl").value||"",t=this.tokenize(r),c=this.allProducts;if(!t.length){this.products=c.slice(0,6);return}c=c.map(a=>{let p=this.normalizeText(a.descripcion??""),I=this.normalizeText(a.codigo??""),ue=t.every(F=>this.textContainsToken(p,F)||this.textContainsToken(I,F))?this.scoreMatch(p,I,t):-1;return{p:a,score:ue}}).filter(a=>a.score>=0).sort((a,p)=>p.score-a.score).map(a=>a.p),this.products=c.slice(0,6)}normalizeText(e){return(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/\s+/g," ").trim()}tokenize(e){return this.normalizeText(e).match(/[a-z0-9]+/gi)?.map(t=>this.normalizeText(t))??[]}stem(e){return e.replace(/(es|s)$/i,"")}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}textContainsToken(e,r){if(!e||!r)return!1;let t=this.escapeRegExp(r),c=this.escapeRegExp(this.stem(r));return e.includes(r)||c&&e.includes(c)||new RegExp(`\\b${t}`,"i").test(e)||new RegExp(`${t}\\b`,"i").test(e)}scoreMatch(e,r,t){let c=0;for(let a of t){let p=this.textContainsToken(r,a);this.textContainsToken(e,a)&&(c+=6),p&&(c+=3),e.startsWith(a)&&(c+=4)}return c}showDefaultProducts(){this.products=this.allProducts.slice(0,this.MAX_RESULTS)}addProductToCart(e){let r=this.cartItems.find(t=>t.descripcion===e.descripcion);r?r.cantidad++:this.cartItems.push({descripcion:e.descripcion,pvp:e.pvp,cantidad:1})}removeItem(e){this.cartItems.splice(e,1)}clearCart(){this.cartItems=[]}recalculate(){}getTotal(){return this.cartItems.reduce((e,r)=>e+r.pvp*r.cantidad,0)}static{this.\u0275fac=function(r){return new(r||o)(O(ae),O(me))}}static{this.\u0275cmp=z({type:o,selectors:[["app-sales-module"]],standalone:!0,features:[R],decls:64,vars:13,consts:[[1,"login-form"],[1,"text-center","mb-4"],[1,"container"],[1,"row"],[1,"col-12","col-lg-7","mb-4"],[1,"card","bg-dark","text-white","p-3","mb-3"],[1,"mb-3"],[1,"form-label"],["type","text","placeholder","Nombre del cliente",1,"form-control",3,"ngModelChange","ngModel"],["type","tel","placeholder","Ej: 0999999999",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-select",3,"ngModelChange","ngModel"],["value","cliente"],["value","distribuidor"],[1,"card","bg-dark","text-white","p-3",3,"formGroup"],["type","search","placeholder","C\xF3digo, nombre o esc\xE1ner...","formControlName","searchControl",1,"form-control","mt-2","mb-3"],["class","table-responsive",4,"ngIf"],["class","text-muted text-center mt-2",4,"ngIf"],[1,"col-12","col-lg-5"],[1,"card","bg-dark","text-white","p-3"],[1,"table-responsive"],[1,"table","table-dark","table-bordered","text-center","align-middle"],[2,"width","110px"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"total-box","mt-4"],[1,"total-label"],[1,"total-value"],[1,"bi","bi-currency-dollar"],[1,"d-flex","gap-3","mt-4"],[1,"btn","btn-success","btn-lg","w-100",3,"click","disabled"],[1,"btn","btn-danger","btn-lg","w-100",3,"click"],[1,"table","table-dark","table-hover","align-middle","mb-0"],["style","cursor:pointer",3,"click",4,"ngFor","ngForOf"],[2,"cursor","pointer",3,"click"],[2,"width","70px"],["class","img-thumbnail","style","width:60px;height:45px;object-fit:cover",3,"src",4,"ngIf"],[1,"text-start"],[1,"fw-bold"],[1,"d-flex","gap-3"],[1,"text-white-50"],[3,"ngClass"],[1,"fw-bold","text-success","text-end"],[1,"img-thumbnail",2,"width","60px","height","45px","object-fit","cover",3,"src"],[1,"text-muted","text-center","mt-2"],["type","number","min","1",1,"form-control","text-center",3,"ngModelChange","ngModel"],[1,"fw-bold","text-success"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"bi","bi-trash"],["colspan","5",1,"text-muted"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"h1"),l(3,"\u{1F4B2}M\xF3dulo de ventas"),i()(),n(4,"div",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"h5"),l(9,"\u{1F464} Datos del Cliente"),i(),n(10,"div",6)(11,"label",7),l(12,"Nombre"),i(),n(13,"input",8),v("ngModelChange",function(a){return M(t.cliente.nombre,a)||(t.cliente.nombre=a),a}),i()(),n(14,"div",6)(15,"label",7),l(16,"Celular"),i(),n(17,"input",9),v("ngModelChange",function(a){return M(t.cliente.celular,a)||(t.cliente.celular=a),a}),i()(),n(18,"div")(19,"label",7),l(20,"Tipo de cliente"),i(),n(21,"select",10),v("ngModelChange",function(a){return M(t.cliente.rol,a)||(t.cliente.rol=a),a}),n(22,"option",11),l(23,"Cliente"),i(),n(24,"option",12),l(25,"Distribuidor"),i()()()(),n(26,"div",13)(27,"h5"),l(28,"\u{1F50D} Buscar producto"),i(),u(29,"input",14),x(30,Me,4,1,"div",15)(31,ve,2,0,"div",16),i()(),n(32,"div",17)(33,"div",18)(34,"h5",6),l(35,"\u{1F9FE} Detalle de Venta"),i(),n(36,"div",19)(37,"table",20)(38,"thead")(39,"tr")(40,"th"),l(41,"Producto"),i(),n(42,"th",21),l(43,"Cantidad"),i(),n(44,"th"),l(45,"PVP"),i(),n(46,"th"),l(47,"Total"),i(),u(48,"th"),i()(),n(49,"tbody"),x(50,Se,14,8,"tr",22)(51,ye,3,0,"tr",23),i()()(),n(52,"div",24)(53,"span",25),l(54,"TOTAL"),i(),n(55,"div",26),u(56,"i",27),l(57),S(58,"number"),i()(),n(59,"div",28)(60,"button",29),f("click",function(){return t.confirmVenta()}),l(61," Vender "),i(),n(62,"button",30),f("click",function(){return t.clearCart()}),l(63," CANCELAR "),i()()()()()()()),r&2&&(s(13),b("ngModel",t.cliente.nombre),s(4),b("ngModel",t.cliente.celular),s(4),b("ngModel",t.cliente.rol),s(5),d("formGroup",t.formGroup),s(4),d("ngIf",t.products.length>0),s(),d("ngIf",t.products.length===0),s(19),d("ngForOf",t.cartItems),s(),d("ngIf",t.cartItems.length===0),s(6),h(" ",G(58,10,t.getTotal(),"1.2-2")," "),s(3),d("disabled",t.cartItems.length===0))},dependencies:[T,U,j,X,$,q,ce,oe,re,K,ee,ie,Q,Y,le,Z,P,te,ne],styles:[".login-form[_ngcontent-%COMP%]{background:#18181c}.login-form[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#fff;font-family:Acephimere,sans-serif;font-weight:1000;font-size:30px;padding-top:20px}.login-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#fff;font-family:Acephimere,sans-serif;font-weight:1000;font-size:15px}.login-form[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#fff;font-family:Acephimere,sans-serif;font-weight:1000;font-size:18px;margin-right:10px}.login-form[_ngcontent-%COMP%]   .small-text[_ngcontent-%COMP%]{font-size:.75rem}.login-form[_ngcontent-%COMP%]   .styled-line[_ngcontent-%COMP%]{height:7px;background-color:#8b50fb;margin:20px auto;width:70%}.login-form[_ngcontent-%COMP%]   .total-box[_ngcontent-%COMP%]{background:linear-gradient(135deg,#198754,#2ecc71);border-radius:18px;padding:20px;text-align:center;box-shadow:0 0 25px #2ecc7166}.login-form[_ngcontent-%COMP%]   .total-label[_ngcontent-%COMP%]{display:block;font-size:1.2rem;font-weight:700;letter-spacing:3px;color:#ffffffd9}.login-form[_ngcontent-%COMP%]   .total-value[_ngcontent-%COMP%]{font-size:3.2rem;font-weight:900;color:#fff;margin-top:8px}.login-form[_ngcontent-%COMP%]   .total-value[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2.4rem;margin-right:8px;vertical-align:middle}"]})}}return o})();var pe=[{path:"",component:k,canActivate:[J]}];var Ue=(()=>{class o{static{this.\u0275fac=function(r){return new(r||o)}}static{this.\u0275mod=B({type:o})}static{this.\u0275inj=V({imports:[T,se,de,H.forChild(pe),P,k]})}}return o})();export{Ue as SalesModuleModule};
