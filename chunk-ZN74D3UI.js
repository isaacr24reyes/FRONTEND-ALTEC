import{a as J}from"./chunk-MP4LVO4K.js";import{a as ce}from"./chunk-ODV6XQGS.js";import"./chunk-4QRD2FVP.js";import{a as fe}from"./chunk-JBVRINQ4.js";import{c as de}from"./chunk-YNROWP4N.js";import"./chunk-SCRHCU3P.js";import{O as me,b as H,c as x,d as K,e as Q,f as X,g as Y,h as Z,i as ee,k as te,l as ne,m as ie,n as re,o as oe,p as ae,q as le,s as se,t as P}from"./chunk-EVUFTYVY.js";import{$a as _,Aa as g,Ab as z,Db as G,Fb as q,Ga as t,Gb as y,Ha as n,Ia as b,Ja as I,K as O,Ka as D,La as V,Na as f,O as T,Oa as U,P as k,Tb as $,U as c,V as u,Ya as R,Za as r,_a as h,bb as v,cb as C,db as w,fb as B,ja as s,jb as E,ka as F,lb as N,mb as L,nb as W,wa as S,zb as j}from"./chunk-C5J53P3W.js";import{h as pe}from"./chunk-K4ALXBGI.js";var p=pe(fe());function ge(l,M){if(l&1){let e=V();t(0,"tr")(1,"td",62),r(2),n(),t(3,"td",63),r(4),n(),t(5,"td",64),r(6),n(),t(7,"td",65),r(8),n(),t(9,"td",66),r(10),n(),t(11,"td",67)(12,"button",68),f("click",function(){let i=c(e).$implicit,a=U();return u(a.abrirConsumirModal(i))}),b(13,"i",69),n()()()}if(l&2){let e,o=M.$implicit;s(2),h(o.name),s(2),h(o.username),s(2),h(o.telefono),s(2),h(o.role),s(2),_("$",(e=o.altec_Points)!==null&&e!==void 0?e:0,"")}}function he(l,M){l&1&&(t(0,"tr")(1,"td",70),r(2,"No hay usuarios registrados."),n()())}function _e(l,M){if(l&1&&(I(0),t(1,"div",71),r(2," Vuelto: "),t(3,"strong"),r(4),E(5,"number"),n()(),D()),l&2){let e,o=U();s(4),_("$",N(5,1,(((e=o.consumirForm.get("efectivo"))==null?null:e.value)||0)-(((e=o.consumirForm.get("diferencia"))==null?null:e.value)||0),"1.2-2"),"")}}function ve(l,M){if(l&1&&(t(0,"div",72),r(1," Falta: "),t(2,"strong"),r(3),E(4,"number"),n()()),l&2){let e,o=U();s(3),_("$",N(4,1,(((e=o.consumirForm.get("diferencia"))==null?null:e.value)||0)-(((e=o.consumirForm.get("efectivo"))==null?null:e.value)||0),"1.2-2"),"")}}var A=(()=>{class l{constructor(e,o){this.accountService=e,this.fb=o,this.isConsumirOpen=!1,this.users=[],this.filteredUsers=[],this.searchTerm="",this.pageSize=6,this.currentPage=1,this.newUser={name:"",telefono:"",role:"Cliente"}}ngOnInit(){this.loadUsers(),this.consumirForm=this.fb.group({venta:[0,[x.required,x.min(0)]],diferencia:[{value:0,disabled:!0}],efectivo:[0,[x.min(0)]]})}round2(e){return Number((e??0).toFixed(2))}loadUsers(){this.accountService.getAllUsers().subscribe({next:e=>{this.users=e,this.filteredUsers=[...this.users]},error:e=>{console.error("\u274C Error al cargar usuarios",e)}})}applyFilter(){let e=this.searchTerm.trim().toLowerCase();this.filteredUsers=e?this.users.filter(o=>(o.name?.toLowerCase()??"").includes(e)):[...this.users],this.currentPage=1}createUser(){if(!this.newUser.name||!this.newUser.telefono){p.default.Report.warning("Campos requeridos","Por favor ingresa <b>nombre</b> y <b>celular</b>.","Entendido");return}p.default.Loading.hourglass("Creando usuario..."),this.accountService.createUser(this.newUser.name,this.newUser.telefono,this.newUser.role).subscribe({next:e=>{p.default.Loading.remove();let o=e.username,i=e.name;p.default.Report.success("Usuario creado",`<br> USERNAME: <span style="color:#28a745; font-weight:bold;">${o}</span>`,"Aceptar"),this.loadUsers(),this.newUser={name:"",telefono:"",role:"Cliente"}},error:e=>{p.default.Loading.remove(),console.error("\u274C Error al crear usuario",e),p.default.Report.failure("Error","No se pudo crear el usuario.","Cerrar")}})}abrirConsumirModal(e){let o=Number(e?.altec_Points??0);if(!isFinite(o)||o<=0){p.default.Report.warning("Sin balance",`<b>${e?.name??e?.name??"Este usuario"}</b> no tiene balance disponible.`,"Cerrar");return}this.selectedUser=e,this.consumirForm.reset({venta:0,diferencia:0}),new bootstrap.Modal(document.getElementById("consumirModal")).show()}calcularDiferencia(){let e=Number(this.consumirForm.get("venta")?.value||0),o=Number(this.selectedUser?.altec_Points??0),i=e<o?0:this.round2(e-o);this.consumirForm.patchValue({diferencia:i},{emitEvent:!1})}confirmarCompra(){let e=Number(this.consumirForm.get("venta")?.value||0),o=Number(this.selectedUser?.altec_Points??0);if(e<o){p.default.Report.failure("Error","La venta no puede ser menor a los puntos acumulados.","Cerrar");return}let i=this.round2(e-o),a=this.round2(i/15);this.accountService.resetAndAddBalance(this.selectedUser.username,a).subscribe({next:d=>{p.default.Loading.remove(),p.default.Report.success("Compra realizada",`Se acreditaron $${a.toFixed(2)} a <b>${this.selectedUser.username}</b>.`,"Aceptar",()=>{this.consumirForm.reset(),this.consumirForm.get("venta")?.setValue(0,{emitEvent:!1}),this.consumirForm.get("diferencia")?.setValue(0,{emitEvent:!1}),this.consumirForm.markAsPristine(),this.consumirForm.markAsUntouched(),this.selectedUser.altec_Points=d.altec_Points??0,this.loadUsers()})},error:()=>{p.default.Loading.remove(),p.default.Report.failure("Error","No se pudo procesar la compra.","Cerrar")}})}onEfectivoInput(){let e=Number(this.consumirForm.get("efectivo")?.value||0);this.consumirForm.get("efectivo")?.setValue(this.round2(e),{emitEvent:!1})}get totalPages(){return Math.ceil(this.filteredUsers.length/this.pageSize)}static{this.\u0275fac=function(o){return new(o||l)(F(ce),F(le))}}static{this.\u0275cmp=T({type:l,selectors:[["app-user-admin"]],standalone:!0,features:[B],decls:111,vars:16,consts:[["faltaTpl",""],[1,"login-form"],[1,"text-center"],[1,"container","mt-4"],[1,"row","justify-content-center","mb-3"],[1,"col-12","col-md-6"],["type","search","placeholder","Buscar usuario por nombre...","aria-label","Buscar","name","searchTerm","autocomplete","off",1,"form-control",3,"ngModelChange","input","ngModel"],[1,"row","justify-content-end","mb-3"],[1,"col-12","col-md-4","text-end"],["type","button","data-bs-toggle","modal","data-bs-target","#crearUsuarioModal",1,"btn","btn-success"],[1,"bi","bi-person-plus"],[1,"row"],[1,"col-12"],[1,"table-responsive","shadow"],[1,"table","table-dark","table-hover","text-center","align-middle","user-table"],[2,"background-color","#08274F","color","white","font-weight","bold"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"styled-line"],[1,"row","justify-content-between","align-items-center"],[1,"col-12","col-md-auto","mb-2","mb-md-0"],[1,"col-12","col-md-auto"],[1,"btn","btn-primary","me-2",3,"click","disabled"],[1,"btn","btn-primary",3,"click","disabled"],[1,"text-center","mt-4"],[1,"text-white","small-text"],[2,"color","#8B50FB"],["id","crearUsuarioModal","tabindex","-1","aria-labelledby","crearUsuarioModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content","bg-dark","text-white"],[1,"modal-header","border-0"],["id","crearUsuarioModalLabel",1,"modal-title","w-100"],["type","button","data-bs-dismiss","modal","aria-label","Cerrar",1,"btn-close","btn-close-white"],[1,"modal-body"],["autocomplete","off"],[1,"mb-3"],["for","name",1,"form-label"],["id","name","type","text","placeholder","Ej: Juan P\xE9rez","name","name","autocomplete","off",1,"form-control",3,"ngModelChange","ngModel"],["for","phone",1,"form-label"],["id","phone","type","text","placeholder","Ej: 0987654321","name","telefono","autocomplete","off",1,"form-control",3,"ngModelChange","ngModel"],["for","role",1,"form-label"],["id","role","name","role",1,"form-select",3,"ngModelChange","ngModel"],["value","Cliente","selected",""],["value","Distribuidor"],[1,"d-grid","gap-2"],["type","button","data-bs-dismiss","modal",1,"btn","btn-primary",3,"click"],[1,"bi","bi-check-circle"],["id","consumirModal","tabindex","-1","aria-labelledby","consumirModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-header"],["id","consumirModalLabel",1,"modal-title"],[3,"formGroup"],["for","venta",1,"form-label"],["id","venta","type","number","min","0","step","0.01","formControlName","venta",1,"form-control",3,"input"],["for","diferencia",1,"form-label"],["id","diferencia","type","number","formControlName","diferencia","readonly","",1,"form-control","bg-secondary","text-white"],["for","efectivo",1,"form-label"],["id","efectivo","type","number","min","0","step","0.01","formControlName","efectivo",1,"form-control",3,"input"],[1,"mt-2"],[4,"ngIf","ngIfElse"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","button",1,"btn","btn-primary",3,"click"],["data-label","Nombre"],["data-label","Username"],["data-label","Celular"],["data-label","Rol"],["data-label","Balance"],["data-label","Acciones"],["aria-label","Acreditar / Consumir",1,"btn","btn-outline-success","btn-sm",3,"click"],[1,"bi","bi-plus-lg"],["colspan","6",1,"text-muted"],[1,"alert","alert-success","py-2","mb-0"],[1,"alert","alert-warning","py-2","mb-0"]],template:function(o,i){if(o&1){let a=V();t(0,"form",1)(1,"div",2)(2,"h1"),r(3,"\u{1F465} Administrador de Usuarios"),n()(),t(4,"div",3)(5,"div",4)(6,"div",5)(7,"input",6),w("ngModelChange",function(m){return c(a),C(i.searchTerm,m)||(i.searchTerm=m),u(m)}),f("input",function(){return c(a),u(i.applyFilter())}),n()()(),t(8,"div",7)(9,"div",8)(10,"button",9),b(11,"i",10),r(12," Crear Usuario "),n()()(),t(13,"div",11)(14,"div",12)(15,"div",13)(16,"table",14)(17,"thead")(18,"tr")(19,"th",15),r(20,"Nombre"),n(),t(21,"th",15),r(22,"Username"),n(),t(23,"th",15),r(24,"Celular"),n(),t(25,"th",15),r(26,"Rol"),n(),t(27,"th",15),r(28,"Balance"),n(),t(29,"th",15),r(30,"Acciones"),n()()(),t(31,"tbody"),S(32,ge,14,5,"tr",16),E(33,"slice"),S(34,he,3,0,"tr",17),n()()()()(),b(35,"hr",18),t(36,"div",3)(37,"div",19)(38,"div",20)(39,"h5"),r(40),n()(),t(41,"div",21)(42,"button",22),f("click",function(){return c(a),u(i.currentPage=i.currentPage-1)}),r(43," Anterior "),n(),t(44,"button",23),f("click",function(){return c(a),u(i.currentPage=i.currentPage+1)}),r(45," Siguiente "),n()()()(),t(46,"div",24)(47,"span",25),r(48," Developed by "),t(49,"strong",26),r(50,"SwiFt\xA9"),n(),r(51," (2025). "),n()()()(),t(52,"div",27)(53,"div",28)(54,"div",29)(55,"div",30)(56,"h5",31),r(57,"\u2795 Crear Nuevo Usuario"),n(),b(58,"button",32),n(),t(59,"div",33)(60,"form",34)(61,"div",35)(62,"label",36),r(63,"Nombre"),n(),t(64,"input",37),w("ngModelChange",function(m){return c(a),C(i.newUser.name,m)||(i.newUser.name=m),u(m)}),n()(),t(65,"div",35)(66,"label",38),r(67,"Celular"),n(),t(68,"input",39),w("ngModelChange",function(m){return c(a),C(i.newUser.telefono,m)||(i.newUser.telefono=m),u(m)}),n()(),t(69,"div",35)(70,"label",40),r(71,"Rol"),n(),t(72,"select",41),w("ngModelChange",function(m){return c(a),C(i.newUser.role,m)||(i.newUser.role=m),u(m)}),t(73,"option",42),r(74,"Cliente"),n(),t(75,"option",43),r(76,"Distribuidor"),n()()(),t(77,"div",44)(78,"button",45),f("click",function(){return c(a),u(i.createUser())}),b(79,"i",46),r(80," Guardar "),n()()()()()()(),t(81,"div",47)(82,"div",28)(83,"div",29)(84,"div",48)(85,"h5",49),r(86,"\u{1F4B3} Consumir Puntos"),n(),b(87,"button",32),n(),t(88,"div",33)(89,"form",50)(90,"div",35)(91,"label",51),r(92,"Venta"),n(),t(93,"input",52),f("input",function(){return c(a),u(i.calcularDiferencia())}),n()(),t(94,"div",35)(95,"label",53),r(96,"Diferencia"),n(),b(97,"input",54),n(),t(98,"div",35)(99,"label",55),r(100,"Efectivo recibido"),n(),t(101,"input",56),f("input",function(){return c(a),u(i.onEfectivoInput())}),n()(),t(102,"div",57),S(103,_e,6,4,"ng-container",58)(104,ve,5,4,"ng-template",null,0,W),n()()(),t(106,"div",59)(107,"button",60),r(108,"Cancelar"),n(),t(109,"button",61),f("click",function(){return c(a),u(i.confirmarCompra())}),r(110,"Comprar"),n()()()()()}if(o&2){let a,d=R(105);s(7),v("ngModel",i.searchTerm),s(25),g("ngForOf",L(33,12,i.filteredUsers,(i.currentPage-1)*i.pageSize,i.currentPage*i.pageSize)),s(2),g("ngIf",i.filteredUsers.length===0),s(6),_("Total de usuarios: ",i.filteredUsers.length,""),s(2),g("disabled",i.currentPage===1),s(2),g("disabled",i.currentPage>=i.totalPages),s(20),v("ngModel",i.newUser.name),s(4),v("ngModel",i.newUser.telefono),s(4),v("ngModel",i.newUser.role),s(17),g("formGroup",i.consumirForm),s(14),g("ngIf",(((a=i.consumirForm.get("efectivo"))==null?null:a.value)||0)>=(((a=i.consumirForm.get("diferencia"))==null?null:a.value)||0))("ngIfElse",d)}},dependencies:[y,j,z,q,G,se,Z,re,oe,H,ee,ie,K,Q,ae,Y,X,P,te,ne],styles:['@charset "UTF-8";.login-form[_ngcontent-%COMP%]{background:#18181c;color:#fff}h1[_ngcontent-%COMP%]{font-weight:700;color:#fff;padding-top:20px}.table[_ngcontent-%COMP%]{border-radius:8px;overflow:hidden}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:.5px}.btn[_ngcontent-%COMP%]{border-radius:20px;font-weight:500}.modal-content[_ngcontent-%COMP%]{border-radius:12px}@media (max-width: 768px){.user-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{display:none}.user-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:block;margin-bottom:.2rem;border-radius:8px;padding:.6rem .8rem;background:#282828;text-align:left;transition:transform .2s ease}.user-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{transform:scale(1.01);background:none}.user-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.1rem 0;font-size:16px;border-bottom:none;background:none}.user-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{border-bottom:none}.user-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:before{content:attr(data-label);font-weight:600;color:#adff2f;flex:1;background:transparent!important}.user-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:2px 8px;font-size:12px;border-radius:6px}}']})}}return l})();var ue=[{path:"",component:A,canActivate:[J]}];var Ie=(()=>{class l{static{this.\u0275fac=function(o){return new(o||l)}}static{this.\u0275mod=k({type:l})}static{this.\u0275inj=O({imports:[y,me,de,P,$.forChild(ue),A]})}}return l})();export{Ie as UserAdminModule};
