import{a as Y}from"./chunk-O6BAHGEK.js";import{a as re}from"./chunk-JMEHCRRW.js";import"./chunk-4QRD2FVP.js";import{a as ce}from"./chunk-E42FEA2W.js";import{c as ie}from"./chunk-QUSHO67F.js";import"./chunk-IHXC5BBL.js";import{O as oe,b as H,c as J,d as W,e as X,h as Z,k as ee,l as te,r as ne,t as x}from"./chunk-AJCMZLG5.js";import{$a as L,Aa as d,Ca as V,Db as w,E as N,Ga as s,Ha as i,Ia as P,K as O,La as y,Na as b,O as T,Oa as g,P as U,Qb as K,U as p,Ua as G,V as f,Va as k,Wa as R,_a as a,ab as I,bb as $,gb as q,i as A,ib as z,ja as c,ka as C,s as S,u as D,w as E,wa as _,xb as B,y as M,yb as j,za as F,zb as Q}from"./chunk-DGXXNF4P.js";import{g as ae}from"./chunk-ODN5LVDJ.js";var m=ae(ce());var me=["productDescriptionInput"],ue=n=>({"rounded-bottom-0":n});function pe(n,u){n&1&&(s(0,"li",22),P(1,"span",23),a(2," Buscando\u2026 "),i())}function fe(n,u){if(n&1){let e=y();s(0,"li")(1,"button",24),b("pointerdown",function(o){let r=p(e).$implicit,l=g(2);return f(l.onSelect(r,o))}),a(2),i()()}if(n&2){let e=u.$implicit,t=u.index,o=g(2);c(),V("active",t===o.activeIndex),c(),I(" ",o.displayName(e)," ")}}function ge(n,u){n&1&&(s(0,"li",25),a(1," Sin resultados "),i())}function he(n,u){if(n&1&&(s(0,"ul",18),_(1,pe,3,0,"li",19)(2,fe,3,3,"li",20)(3,ge,2,0,"li",21),i()),n&2){let e=g();c(),d("ngIf",e.loading),c(),d("ngForOf",e.suggestions),c(),d("ngIf",!e.loading&&e.suggestions.length===0)}}function _e(n,u){if(n&1&&(s(0,"div",26)(1,"div",27)(2,"div",28)(3,"span",29),a(4,"Cliente:"),i(),a(5),i(),s(6,"div",30)(7,"span",31),a(8,"Altec puntos:"),i(),s(9,"div",32)(10,"span",33),a(11),i(),s(12,"small",34),a(13),i()()()()()),n&2){let e=g();c(5),$(" ",e.selectedUser.name," (",e.selectedUser.username,") "),c(6),L(e.selectedUser.altec_Points),c(2),I("\u2248 ",e.selectedUserUsdEquivalent,"")}}function be(n,u){n&1&&(s(0,"small",35),a(1," El nombre del cliente es requerido. "),i())}var v=(()=>{class n{constructor(e,t){this.fb=e,this.account=t,this.AP_PER_USD_DISPLAY=150,this.POINTS_PER_DOLLAR=10,this.showDropdown=!1,this.activeIndex=-1,this.selectedItem=null,this.suggestions=[],this.loading=!1,this.blurTimer=null,this.selectedUser=null,this.isSubmitting=!1}ngOnInit(){this.formGroup=this.fb.group({productDescription:["",[J.required]],productCode:["",[]]}),this.formGroup.get("productDescription").valueChanges.pipe(E(250),M(),S(e=>typeof e=="string"&&e.trim().length>=2),N(e=>(this.loading=!0,this.showDropdown=!0,this.activeIndex=-1,this.selectedUser=null,this.account.searchUsersByName(e.trim(),1,10).pipe(D(()=>A([])))))).subscribe(e=>{this.suggestions=Array.isArray(e)?e:[],this.loading=!1,this.showDropdown=!0})}toNumber(e){if(typeof e=="number")return e;if(typeof e!="string")return NaN;let t=e.trim();if(!t)return NaN;if(/^[\d.]+,\d{1,2}$/.test(t)){let l=t.replace(/\./g,"").replace(",",".");return Number(l)}let r=t.replace(/,/g,"");return Number(r)}moneyToPoints(e){let t=e*this.POINTS_PER_DOLLAR;return Math.floor(t)}deferClose(){this.blurTimer=setTimeout(()=>{this.showDropdown=!1,this.blurTimer=null},80)}blurInput(){let e=this.productInput?.nativeElement;e&&requestAnimationFrame(()=>e.blur())}onSearchKeydown(e){!this.showDropdown||!this.suggestions.length&&!this.loading||(e.key==="ArrowDown"?(e.preventDefault(),this.activeIndex=(this.activeIndex+1)%Math.max(this.suggestions.length,1)):e.key==="ArrowUp"?(e.preventDefault(),this.activeIndex=this.activeIndex<=0?this.suggestions.length-1:this.activeIndex-1):e.key==="Enter"?this.activeIndex>=0&&this.suggestions[this.activeIndex]&&(e.preventDefault(),this.selectSuggestion(this.suggestions[this.activeIndex])):e.key==="Escape"&&(this.showDropdown=!1,this.activeIndex=-1))}onSelect(e,t){this.blurTimer&&(clearTimeout(this.blurTimer),this.blurTimer=null),t?.preventDefault(),t?.stopPropagation();let o=this.displayName(e);this.formGroup.get("productDescription")?.setValue(o,{emitEvent:!1}),this.formGroup.get("productDescription")?.markAsDirty(),this.formGroup.get("productDescription")?.markAsTouched(),this.showDropdown=!1,this.loading=!1,this.suggestions=[],this.selectedUser=e,this.selectedItem=e,this.activeIndex=-1,this.blurInput()}clearOnFocus(){this.formGroup.get("productDescription")?.setValue("",{emitEvent:!1}),this.activeIndex=-1,this.selectedItem=null,this.showDropdown=!1,this.selectedUser=null,this.showDropdown=!1}selectSuggestion(e){let t=this.displayName(e);this.formGroup.get("productDescription")?.setValue(t,{emitEvent:!1}),this.showDropdown=!1,this.loading=!1,this.suggestions=[],this.selectedUser=e,this.selectedItem=e,this.activeIndex=-1,this.blurInput()}displayName(e){return e?.name??e?.username??e?.fullName??e?.email??""}onSubmit(){if(!this.formGroup.valid)return;let e=this.selectedUser?.name??(this.formGroup.value.productDescription||"").toString().trim(),t=this.formGroup.value.productCode,o=this.toNumber(t);if(!e){m.default.Notify.warning("Falta el nombre del cliente.");return}if(isNaN(o)||o<=0){m.default.Notify.failure("Monto inv\xE1lido. Ingrese un valor mayor a 0.");return}let r=this.moneyToPoints(o);m.default.Confirm.show("\xBFAcreditar puntos?",`Vas a acreditar <b>${r} AP</b> a <b>${e}</b>`,"S\xED, acreditar","Cancelar",()=>{this.isSubmitting=!0,m.default.Loading.standard("Acreditando puntos..."),this.account.addPoints(e,r).subscribe({next:l=>{this.isSubmitting=!1,m.default.Loading.remove();let h=(l&&(l.currentPoints??l.totalPoints??l.points??l.pointsBalance??l.balance??l?.data?.currentPoints??l?.data?.totalPoints))??null,le=h!==null?`<b>${e}</b> tiene actualmente <b>${h} AP</b>.`:`Se acreditaron <b>${r} AP</b> a <b>${e}</b>.`;m.default.Report.success("Puntos acreditados",le,"Aceptar"),this.resetFormAndFocus()},error:l=>{this.isSubmitting=!1,m.default.Loading.remove(),console.error("Error acreditando puntos:",l),m.default.Report.failure("Error","No se pudo acreditar los puntos. Int\xE9ntalo nuevamente.","Cerrar")}})},()=>{})}get selectedUserUsdEquivalent(){let t=(Number(this.selectedUser?.altec_Points)||0)/this.AP_PER_USD_DISPLAY;return new Intl.NumberFormat("es-EC",{style:"currency",currency:"USD"}).format(t)}resetFormAndFocus(){this.formGroup.reset({productDescription:"",productCode:""}),this.selectedUser=null,this.selectedItem=null,this.suggestions=[],this.activeIndex=-1,this.showDropdown=!1,setTimeout(()=>{this.productInput?.nativeElement?.focus()},0)}static{this.\u0275fac=function(t){return new(t||n)(C(ne),C(re))}}static{this.\u0275cmp=T({type:n,selectors:[["app-altec-points"]],viewQuery:function(t,o){if(t&1&&G(me,5),t&2){let r;k(r=R())&&(o.productInput=r.first)}},standalone:!0,features:[q],decls:31,vars:8,consts:[["productDescriptionInput",""],[1,"login-form",3,"ngSubmit","formGroup"],[1,"text-center"],[1,"container",2,"max-width","800px"],[1,"row","mt-3"],[1,"col-12"],[1,"text-left"],[1,"autocomplete-wrapper","position-relative","p-0"],["type","text","id","productDescription","formControlName","productDescription","placeholder","Ingresa el nombre del cliente","autocomplete","off",1,"form-control","gray-input",3,"focus","blur","keydown","ngClass"],["class","dropdown-menu show mt-0 shadow border-top-0 rounded-top-0 autocomplete-menu",4,"ngIf"],["class","selected-user-card mt-2",4,"ngIf"],["class","text-danger",4,"ngIf"],["type","text","id","productCode","formControlName","productCode","placeholder","Valor(USD)..","autocomplete","off",1,"form-control","gray-input"],[1,"text-center","mt-3"],["type","submit",1,"btn","btn-primary"],[1,"text-center","mt-5"],[1,"text-white","small-text"],[2,"color","#8B50FB"],[1,"dropdown-menu","show","mt-0","shadow","border-top-0","rounded-top-0","autocomplete-menu"],["class","dropdown-item text-muted d-flex align-items-center gap-2",4,"ngIf"],[4,"ngFor","ngForOf"],["class","dropdown-item text-muted",4,"ngIf"],[1,"dropdown-item","text-muted","d-flex","align-items-center","gap-2"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],["type","button",1,"dropdown-item",3,"pointerdown"],[1,"dropdown-item","text-muted"],[1,"selected-user-card","mt-2"],[1,"row","g-2","align-items-center"],[1,"col-12","col-md"],[1,"suc-label"],[1,"col-12","col-md-auto"],[1,"suc-label","me-2"],[1,"d-flex","flex-column","align-items-start","align-items-md-end"],[1,"points-badge"],[1,"mt-1",2,"color","rgba(255,255,255,.85)"],[1,"text-danger"]],template:function(t,o){if(t&1){let r=y();s(0,"form",1),b("ngSubmit",function(){return p(r),f(o.onSubmit())}),s(1,"div",2)(2,"h1"),a(3,"Acreditar Altec-Puntos"),i()(),s(4,"div",3)(5,"div",4)(6,"div",5)(7,"h2",6),a(8,"Cliente:"),i()(),s(9,"div",5)(10,"div",7)(11,"input",8,0),b("focus",function(){return p(r),f(o.clearOnFocus())})("blur",function(){return p(r),f(o.deferClose())})("keydown",function(h){return p(r),f(o.onSearchKeydown(h))}),i(),_(13,he,4,3,"ul",9),i(),_(14,_e,14,4,"div",10)(15,be,2,0,"small",11),i()(),s(16,"div",4)(17,"div",5)(18,"h2",6),a(19,"Monto de Venta ($):"),i()(),s(20,"div",5),P(21,"input",12),i()()(),s(22,"div",13)(23,"button",14),a(24,"ACREDITAR"),i()(),s(25,"div",15)(26,"span",16),a(27," Developed by "),s(28,"strong",17),a(29,"SwiFt\xA9"),i(),a(30," (2025). "),i()()()}if(t&2){let r;d("formGroup",o.formGroup),c(11),d("ngClass",z(6,ue,o.showDropdown)),F("aria-expanded",o.showDropdown),c(2),d("ngIf",o.showDropdown),c(),d("ngIf",o.selectedUser),c(),d("ngIf",((r=o.formGroup.get("productDescription"))==null?null:r.invalid)&&((r=o.formGroup.get("productDescription"))==null?null:r.touched))}},dependencies:[w,B,j,Q,x,Z,H,W,X,ee,te],styles:[".login-form[_ngcontent-%COMP%]{background:#18181c}.login-form[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#fff;font-family:Acephimere,sans-serif;font-weight:1000;font-size:35px;padding-top:20px}.login-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#fff;font-family:Acephimere,sans-serif;font-weight:1000;font-size:15px}.login-form[_ngcontent-%COMP%]   .small-text[_ngcontent-%COMP%]{font-size:.75rem}.login-form[_ngcontent-%COMP%]   .gray-input[_ngcontent-%COMP%]{background-color:#18181c;color:#fff}.login-form[_ngcontent-%COMP%]   .gray-input[_ngcontent-%COMP%]::placeholder{color:#7b7979!important}.login-form[_ngcontent-%COMP%]   .gray-input-select[_ngcontent-%COMP%]{background-color:#18181c;color:#fff!important}.login-form[_ngcontent-%COMP%]   .gray-input-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{color:#fff!important;background-color:#18181c}.autocomplete-menu[_ngcontent-%COMP%]{position:absolute;left:0;right:0;top:100%;transform:none!important;min-width:0;max-height:260px;overflow:auto;z-index:1000}.selected-user-card[_ngcontent-%COMP%]{color:#fff;background:linear-gradient(135deg,#1f2937,#111827);border:1px solid rgba(255,255,255,.12);border-radius:.75rem;padding:1rem;box-shadow:0 6px 18px #0000004d}.selected-user-card[_ngcontent-%COMP%]   .suc-label[_ngcontent-%COMP%]{opacity:.9;font-weight:600}.selected-user-card[_ngcontent-%COMP%]   .points-badge[_ngcontent-%COMP%]{display:inline-block;padding:.35rem .6rem;border-radius:999px;background:#8b50fb26;border:1px solid rgba(139,80,251,.35);color:#fff;font-weight:700;letter-spacing:.3px}"]})}}return n})();var se=[{path:"",component:v,canActivate:[Y]}];var Ve=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=U({type:n})}static{this.\u0275inj=O({imports:[w,oe,ie,x,K.forChild(se),v]})}}return n})();export{Ve as AltecPointsModule};
