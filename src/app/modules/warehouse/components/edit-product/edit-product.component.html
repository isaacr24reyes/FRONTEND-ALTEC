<div class="modern-edit-page" *ngIf="!isLoading">
  <form [formGroup]="formGroup" (ngSubmit)="onSubmit()">

    <!-- üé® HERO SECTION -->
    <div class="edit-hero">
      <div class="container">
        <div class="animate-fade-in">
          <h1 class="hero-title">
            <i class="bi bi-pencil-square me-3"></i>
            <span class="text-gradient">Editar</span> Productos
          </h1>
          <p class="hero-subtitle">Gestiona y actualiza tu inventario de forma r√°pida y eficiente</p>
        </div>
      </div>
    </div>

    <!-- üîç B√öSQUEDA -->
    <div class="search-section">
      <div class="container">
        <div class="search-wrapper animate-fade-in-delay">
          <i class="bi bi-search search-icon"></i>
          <input
            type="search"
            class="search-input"
            placeholder="Buscar por c√≥digo o descripci√≥n..."
            formControlName="searchControl">
          <button
            *ngIf="formGroup.get('searchControl')?.value"
            type="button"
            class="search-clear"
            (click)="formGroup.get('searchControl')?.setValue('')">
            <i class="bi bi-x-circle-fill"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- üéõÔ∏è FILTROS -->
    <div class="filters-section">
      <div class="container">
        <div class="filters-wrapper">

          <!-- Filtro: Importaci√≥n -->
          <div class="filter-chip">
            <input
              class="filter-checkbox"
              type="checkbox"
              id="importCheck"
              formControlName="importCheck"
              (change)="toggleImport()">
            <label class="filter-label" for="importCheck">
              <i class="bi bi-globe me-2"></i>
              <span>Importaci√≥n</span>
              <span class="filter-badge" *ngIf="formGroup.get('importCheck')?.value">‚úì</span>
            </label>
          </div>

          <!-- Filtro: Stock bajo -->
          <div class="filter-chip">
            <input
              class="filter-checkbox"
              type="checkbox"
              id="lowStockCheck"
              formControlName="lowStockCheck"
              (change)="toggleLowStock()">
            <label class="filter-label" for="lowStockCheck">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              <span>Stock &lt; 5</span>
              <span class="filter-badge" *ngIf="formGroup.get('lowStockCheck')?.value">‚úì</span>
            </label>
          </div>

          <!-- Filtro: Sin imagen -->
          <div class="filter-chip">
            <input
              class="filter-checkbox"
              type="checkbox"
              id="noImageCheck"
              formControlName="noImageCheck"
              (change)="toggleNoImage()">
            <label class="filter-label" for="noImageCheck">
              <i class="bi bi-image me-2"></i>
              <span>Sin Imagen</span>
              <span class="filter-badge" *ngIf="formGroup.get('noImageCheck')?.value">‚úì</span>
            </label>
          </div>

          <!-- Filtro: Categor√≠as -->
          <div class="dropdown filter-dropdown">
            <button class="filter-dropdown-btn" type="button" data-bs-toggle="dropdown">
              <i class="bi bi-funnel-fill me-2"></i>
              <span>Categor√≠a</span>
              <i class="bi bi-chevron-down ms-2"></i>
            </button>
            <ul class="dropdown-menu modern-dropdown">
              <li>
                <button class="dropdown-item" type="button" (click)="filtrarCategoria('')">
                  <i class="bi bi-check-circle-fill me-2"></i>
                  Todas las categor√≠as
                </button>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li *ngFor="let cat of categoriasValidas">
                <button class="dropdown-item" type="button" (click)="filtrarCategoria(cat)">
                  <i class="bi bi-tag-fill me-2"></i>
                  {{ cat }}
                </button>
              </li>
            </ul>
          </div>

        </div>
      </div>
    </div>

    <!-- üè∑Ô∏è FILTROS ACTIVOS -->
    <div class="active-filters-section" *ngIf="selectedCategory || onlyImport || onlyLowStock || onlyNoImage">
      <div class="container">
        <div class="active-filters-wrapper animate-fade-in">
          <div class="active-filters-label">
            <i class="bi bi-funnel-fill me-2"></i>
            <span>Filtros activos:</span>
          </div>

          <div class="active-filters-chips">
            <!-- Chip: Categor√≠a -->
            <div class="active-chip" *ngIf="selectedCategory">
              <i class="bi bi-tag-fill"></i>
              <span>{{ selectedCategory }}</span>
              <button class="chip-remove" (click)="filtrarCategoria('')" title="Quitar filtro">
                <i class="bi bi-x"></i>
              </button>
            </div>

            <!-- Chip: Importaci√≥n -->
            <div class="active-chip" *ngIf="onlyImport">
              <i class="bi bi-globe"></i>
              <span>Productos de importaci√≥n</span>
              <button class="chip-remove" (click)="toggleImport()" title="Quitar filtro">
                <i class="bi bi-x"></i>
              </button>
            </div>

            <!-- Chip: Stock bajo -->
            <div class="active-chip" *ngIf="onlyLowStock">
              <i class="bi bi-exclamation-triangle-fill"></i>
              <span>Stock menor a 5</span>
              <button class="chip-remove" (click)="toggleLowStock()" title="Quitar filtro">
                <i class="bi bi-x"></i>
              </button>
            </div>

            <!-- Chip: Sin imagen -->
            <div class="active-chip" *ngIf="onlyNoImage">
              <i class="bi bi-image"></i>
              <span>Sin imagen</span>
              <button class="chip-remove" (click)="toggleNoImage()" title="Quitar filtro">
                <i class="bi bi-x"></i>
              </button>
            </div>

            <!-- Bot√≥n: Limpiar todos -->
            <button class="clear-all-btn" (click)="clearAllFilters()" title="Limpiar todos los filtros">
              <i class="bi bi-trash-fill me-2"></i>
              Limpiar todo
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- üì¶ GRID DE PRODUCTOS -->
    <div class="products-section">
      <div class="container">

        <!-- Contador de productos -->
        <div class="products-count">
          <i class="bi bi-box-seam-fill me-2"></i>
          <span>Total de productos: <strong>{{ totalCount }}</strong></span>
        </div>

        <!-- Grid de cards -->
        <div class="products-grid">
          <div class="product-card" *ngFor="let producto of products" (click)="openModal(producto)">
            <div class="card-image">
              <img *ngIf="producto.foto && producto.foto !== 'NOT-IMAGE'"
                   [src]="producto.foto"
                   alt="Producto">
              <div *ngIf="!producto.foto || producto.foto === 'NOT-IMAGE'" class="no-image-card">
                <i class="bi bi-image"></i>
              </div>

              <!-- Badges sobre la imagen -->
              <div class="card-badges">
                <span class="badge-import" *ngIf="producto.isImport">
                  <i class="bi bi-globe"></i>
                </span>
                <span class="badge-stock" *ngIf="producto.stock < 5">
                  <i class="bi bi-exclamation-triangle-fill"></i> {{ producto.stock }}
                </span>
              </div>
            </div>

            <div class="card-content">
              <span class="card-code">{{ producto.codigo }}</span>
              <h3 class="card-title">{{ producto.descripcion }}</h3>

              <div class="card-info">
                <div class="info-item">
                  <i class="bi bi-box-seam"></i>
                  <span>Stock: {{ producto.stock }}</span>
                </div>
                <div class="info-item">
                  <i class="bi bi-currency-dollar"></i>
                  <span>{{ producto.pvp | currency }}</span>
                </div>
              </div>

              <button class="card-btn" (click)="openModal(producto); $event.stopPropagation()">
                <i class="bi bi-pencil-square me-2"></i>
                Editar
              </button>
            </div>
          </div>
        </div>

        <!-- Paginaci√≥n -->
        <div class="pagination-wrapper">
          <button
            type="button"
            class="btn-pagination"
            [disabled]="currentPage === 1"
            (click)="onPreviousPage()">
            <i class="bi bi-chevron-left me-2"></i>
            Anterior
          </button>

          <div class="pagination-info">
            P√°gina <strong>{{ currentPage }}</strong> de <strong>{{ totalPages }}</strong>
          </div>

          <button
            type="button"
            class="btn-pagination"
            [disabled]="currentPage === totalPages"
            (click)="onNextPage()">
            Siguiente
            <i class="bi bi-chevron-right ms-2"></i>
          </button>
        </div>

      </div>
    </div>

  </form>

  <!-- üî≤ MODAL DE EDICI√ìN -->
  <div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content modern-modal">
        <div class="modal-header modern-modal-header">
          <h5 class="modal-title">
            <i class="bi bi-pencil-square me-2"></i>
            Editar Producto
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body modern-modal-body" *ngIf="selectedProduct">
          <form class="edit-form">

            <!-- Categor√≠a -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-tag-fill me-2"></i>
                Categor√≠a
              </label>
              <select
                class="form-select-modern"
                [(ngModel)]="selectedProduct.categoria"
                name="categoria">
                <option *ngIf="!categoriasValidas.includes(categoriaActual)" [value]="categoriaActual">
                  {{ categoriaActual }}
                </option>
                <option *ngFor="let categoria of categoriasValidas" [value]="categoria">
                  {{ categoria }}
                </option>
              </select>
            </div>

            <!-- C√≥digo -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-upc-scan me-2"></i>
                C√≥digo
              </label>
              <input
                type="text"
                class="form-input-modern"
                [(ngModel)]="selectedProduct.codigo"
                name="codigo"
                placeholder="Ej: ABC123">
            </div>

            <!-- Switch: ¬øEs importado? -->
            <div class="form-group-switch">
              <div class="switch-container">
                <input
                  type="checkbox"
                  class="switch-input"
                  id="isImportCheck"
                  [(ngModel)]="selectedProduct.isImport"
                  name="isImport">
                <label class="switch-label" for="isImportCheck">
                  <span class="switch-text">
                    <i class="bi bi-globe me-2"></i>
                    ¬øEs producto importado?
                  </span>
                  <span class="switch-status">
                    {{ selectedProduct.isImport ? 'S√≠' : 'No' }}
                  </span>
                </label>
              </div>
            </div>

            <!-- Descripci√≥n -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-text-left me-2"></i>
                Descripci√≥n
              </label>
              <input
                type="text"
                class="form-input-modern"
                [(ngModel)]="selectedProduct.descripcion"
                name="descripcion"
                placeholder="Descripci√≥n del producto">
            </div>

            <!-- Fila: Stock y PVP -->
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">
                  <i class="bi bi-box-seam me-2"></i>
                  Stock
                </label>
                <input
                  type="number"
                  class="form-input-modern"
                  [(ngModel)]="selectedProduct.stock"
                  name="stock"
                  placeholder="0">
              </div>

              <div class="form-group">
                <label class="form-label">
                  <i class="bi bi-currency-dollar me-2"></i>
                  PVP
                </label>
                <input
                  type="number"
                  class="form-input-modern"
                  [(ngModel)]="selectedProduct.pvp"
                  name="pvp"
                  placeholder="0.00"
                  step="0.01">
              </div>
            </div>

            <!-- Fila: Precio Mayorista y Precio Importaci√≥n -->
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">
                  <i class="bi bi-cart-check me-2"></i>
                  Precio Mayorista
                </label>
                <input
                  type="number"
                  class="form-input-modern"
                  [(ngModel)]="selectedProduct.precioMayorista"
                  name="precioMayorista"
                  placeholder="0.00"
                  step="0.01">
              </div>

              <div class="form-group">
                <label class="form-label">
                  <i class="bi bi-globe me-2"></i>
                  Precio Importaci√≥n
                </label>
                <input
                  type="number"
                  class="form-input-modern"
                  [(ngModel)]="selectedProduct.precioImportacion"
                  name="precioImportacion"
                  placeholder="0.00"
                  step="0.01">
              </div>
            </div>

            <!-- Actualizar Foto -->
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-image me-2"></i>
                Actualizar Foto
              </label>
              <div class="file-input-wrapper">
                <input
                  type="file"
                  class="file-input-modern"
                  id="fileInput"
                  (change)="onFileSelected($event)"
                  accept="image/*">
                <label for="fileInput" class="file-input-label">
                  <i class="bi bi-cloud-upload me-2"></i>
                  Seleccionar imagen
                </label>
              </div>
            </div>

          </form>
        </div>

        <div class="modal-footer modern-modal-footer">
          <button type="button" class="btn-modal-cancel" data-bs-dismiss="modal">
            <i class="bi bi-x-circle me-2"></i>
            Cancelar
          </button>
          <button type="button" class="btn-modal-confirm" (click)="guardarEdicion()">
            <i class="bi bi-check-circle-fill me-2"></i>
            Guardar Cambios
          </button>
        </div>
      </div>
    </div>
  </div>

</div>


