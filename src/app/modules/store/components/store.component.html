<app-loader></app-loader>

<!-- ðŸŽ¨ HERO SECTION MODERNO -->
<div class="store-hero position-relative" #storeHero [class.hero-compact]="isSearching">
  <!-- ðŸ§  Canvas de neuronas animadas -->
  <canvas #neuronCanvas class="neuron-canvas-store"></canvas>

  <div class="hero-background"></div>
  <div class="container position-relative">
    <div class="row justify-content-center" [class.py-5]="!isSearching" [class.py-3]="isSearching">
      <div class="col-12 col-lg-10 text-center">

        <!-- Saludo personalizado con animaciÃ³n (se oculta al buscar) -->
        <div class="hero-greeting mb-3" *ngIf="!isSearching">
          <h1 class="display-4 fw-bold text-white mb-2 animate-fade-in">
            <span *ngIf="isDistribuidor">Â¡Hola, {{ distribuidorName }}! ðŸ‘‹</span>
            <span *ngIf="isCliente && !isDistribuidor">Â¡Hola, {{ clienteName }}! ðŸŽ‰</span>
            <span *ngIf="!isDistribuidor && !isCliente">
              Â¡Bienvenido a la tienda de ALTEC!
              <i class="bi bi-lightning-charge-fill text-danger ms-2 icon-pulse"></i>
            </span>
          </h1>

          <p class="lead text-white-50 mb-4 animate-fade-in-delay">
            {{
              isDistribuidor
                ? 'Accede a precios exclusivos mayoristas y productos premium'
                : isCliente
                  ? 'ContinÃºa acumulando Altec-Puntos con cada compra'
                  : 'Descubre tecnologÃ­a de calidad para tus proyectos'
            }}
          </p>

          <!-- Badge de rol -->
          @if (isDistribuidor) {
            <span class="badge bg-gradient-purple px-4 py-2 rounded-pill mb-4">
              <i class="bi bi-star-fill me-2"></i>Distribuidor Premium
            </span>
          } @else if (isCliente) {
            <span class="badge bg-gradient-blue px-4 py-2 rounded-pill mb-4">
              <i class="bi bi-award-fill me-2"></i>Cliente Verificado
            </span>
          }
        </div>

        <!-- TÃ­tulo compacto cuando hay bÃºsqueda -->
        <div class="hero-search-title mb-2" *ngIf="isSearching">
          <h3 class="h5 text-white fw-bold mb-0">
            <i class="bi bi-search me-2"></i>Buscando en ALTEC Store
          </h3>
        </div>

        <!-- Barra de bÃºsqueda mejorada -->
        <form [formGroup]="formGroup" (ngSubmit)="onSubmit()">
          <div class="search-container mx-auto">
            <div class="input-group input-group-lg shadow-lg">
              <span class="input-group-text bg-dark border-0">
                <i class="bi bi-search text-primary"></i>
              </span>
              <input
                type="search"
                class="form-control form-control-lg border-0 bg-dark text-white"
                placeholder="Buscar productos, categorÃ­as, cÃ³digos..."
                aria-label="Buscar productos"
                formControlName="searchTerm"
                (input)="onSearchChange()"
                spellcheck="false"
                autocomplete="off"
                autocapitalize="off"
              />
              <button
                type="button"
                class="btn btn-primary d-none d-md-inline-flex align-items-center gap-2"
                (click)="onSearchChange()">
                <i class="bi bi-search"></i>
                <span>Buscar</span>
              </button>
              <button
                type="button"
                class="btn btn-outline-light d-inline-flex d-md-none align-items-center gap-2"
                data-bs-toggle="offcanvas"
                data-bs-target="#filtersOffcanvas"
                aria-controls="filtersOffcanvas">
                <i class="bi bi-funnel"></i>
                <span>Filtros</span>
              </button>
            </div>
          </div>
        </form>

        <!-- Stats rÃ¡pidas (se ocultan al buscar) -->
        <div class="row g-3 mt-4 d-none d-lg-flex" *ngIf="!isSearching">
          <div class="col-4">
            <div class="stat-card">
              <i class="bi bi-box-seam text-primary fs-3 mb-2"></i>
              <h3 class="h5 text-white mb-0">{{ totalCount }}+</h3>
              <p class="text-white-50 small mb-0">Productos</p>
            </div>
          </div>
          <div class="col-4">
            <div class="stat-card">
              <i class="bi bi-lightning-charge text-warning fs-3 mb-2"></i>
              <h3 class="h5 text-white mb-0">EnvÃ­o RÃ¡pido</h3>
              <p class="text-white-50 small mb-0">24-48 horas</p>
            </div>
          </div>
          <div class="col-4">
            <div class="stat-card">
              <i class="bi bi-shield-check text-success fs-3 mb-2"></i>
              <h3 class="h5 text-white mb-0">GarantÃ­a</h3>
              <p class="text-white-50 small mb-0">Calidad asegurada</p>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- ðŸ›ï¸ CONTENEDOR PRINCIPAL DE LA TIENDA -->
<div class="container-fluid store-container py-4">
  <div class="row g-4">

    <!-- ðŸ“‚ SIDEBAR DE FILTROS (Desktop) -->
    <aside class="col-lg-3 d-none d-lg-block">
      <div class="filters-sidebar sticky-top">
        <div class="card border-0 shadow-lg">
          <div class="card-body p-4">

            <!-- Header de filtros -->
            <div class="d-flex align-items-center justify-content-between mb-4">
              <h5 class="mb-0 d-flex align-items-center gap-2">
                <i class="bi bi-funnel-fill text-primary"></i>
                <span class="fw-bold">Filtros</span>
              </h5>
              <span class="badge bg-primary rounded-pill">{{ selectedCategories.length }}</span>
            </div>

            <!-- BotÃ³n limpiar filtros -->
            <button
              class="btn btn-outline-secondary w-100 mb-4 d-flex align-items-center justify-content-center gap-2"
              type="button"
              (click)="clearFilters()"
              [disabled]="selectedCategories.length === 0">
              <i class="bi bi-x-circle"></i>
              <span>Limpiar filtros</span>
            </button>

            <!-- CategorÃ­as -->
            <div class="filter-section">
              <h6 class="filter-title text-uppercase mb-3">
                <i class="bi bi-grid-3x3-gap me-2"></i>
                CategorÃ­as
              </h6>

              <div class="categories-list">
                <label
                  *ngFor="let cat of categories"
                  class="category-item">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    [value]="cat"
                    [checked]="selectedCategories.includes(cat)"
                    (change)="onCategoryChange($event)"
                  />
                  <span class="category-label">{{ cat }}</span>
                  <i class="bi bi-chevron-right category-arrow"></i>
                </label>
              </div>
            </div>

            <!-- Info adicional -->
            <div class="filter-info mt-4 p-3 rounded">
              <i class="bi bi-info-circle text-primary me-2"></i>
              <small class="text-white-50">
                Selecciona categorÃ­as para filtrar productos
              </small>
            </div>

          </div>
        </div>
      </div>
    </aside>

    <!-- ðŸ“± OFFCANVAS DE FILTROS (Mobile) -->
    <div class="offcanvas offcanvas-start offcanvas-modern" tabindex="-1" id="filtersOffcanvas">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title d-flex align-items-center gap-2">
          <i class="bi bi-funnel-fill text-primary"></i>
          <span class="fw-bold">Filtros de BÃºsqueda</span>
          @if (selectedCategories.length > 0) {
            <span class="badge bg-primary rounded-pill">{{ selectedCategories.length }}</span>
          }
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>

      <div class="offcanvas-body">
        <!-- Botones de acciÃ³n destacados -->
        <div class="filter-actions-mobile mb-4">
          <button
            class="btn btn-outline-danger w-100 mb-2 d-flex align-items-center justify-content-center gap-2"
            type="button"
            (click)="clearFilters()"
            [disabled]="selectedCategories.length === 0">
            <i class="bi bi-x-circle-fill"></i>
            <span>Limpiar todos los filtros</span>
          </button>
          <button
            class="btn btn-primary w-100 d-flex align-items-center justify-content-center gap-2"
            type="button"
            data-bs-dismiss="offcanvas"
            (click)="applyFilter()">
            <i class="bi bi-check-circle-fill"></i>
            <span>Aplicar filtros ({{ selectedCategories.length }})</span>
          </button>
        </div>

        <!-- Info de ayuda -->
        <div class="alert alert-info d-flex align-items-start gap-2 mb-4" role="alert">
          <i class="bi bi-info-circle-fill flex-shrink-0 mt-1"></i>
          <small>Selecciona una o mÃ¡s categorÃ­as para filtrar los productos mostrados</small>
        </div>

        <!-- CategorÃ­as mÃ³vil -->
        <div class="filter-section-mobile">
          <h6 class="filter-title-mobile mb-3">
            <i class="bi bi-grid-3x3-gap-fill me-2"></i>
            CategorÃ­as disponibles
          </h6>

          <div class="categories-list-mobile">
            <label
              *ngFor="let cat of categories"
              class="category-item-mobile">
              <div class="form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  [id]="'mobile-cat-' + cat"
                  [value]="cat"
                  [checked]="selectedCategories.includes(cat)"
                  (change)="onCategoryChange($event)"
                />
                <label class="form-check-label w-100" [for]="'mobile-cat-' + cat">
                  <span class="category-name">{{ cat }}</span>
                  <i class="bi bi-chevron-right category-arrow"></i>
                </label>
              </div>
            </label>
          </div>
        </div>

        <!-- BotÃ³n aplicar fijo al final -->
        <div class="filter-actions-bottom mt-4 pt-3 border-top">
          <button
            class="btn btn-lg btn-primary w-100 shadow-lg d-flex align-items-center justify-content-center gap-2"
            type="button"
            data-bs-dismiss="offcanvas"
            (click)="applyFilter()">
            <i class="bi bi-check-circle-fill"></i>
            <span>Ver resultados</span>
          </button>
        </div>
      </div>
    </div>

    <!-- ðŸ›ï¸ GRID DE PRODUCTOS -->
    <section class="col-12 col-lg-9" #resultsSection>

      <!-- Header de resultados -->
      <div class="results-header mb-4">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
          <div>
            <h4 class="mb-1 text-white fw-bold">
              @if (selectedCategories.length > 0) {
                Resultados filtrados
              } @else {
                Todos los productos
              }
            </h4>
            <p class="text-white-50 mb-0">
              <i class="bi bi-box-seam me-1"></i>
              Mostrando {{ products.length }} de {{ totalCount }} productos
            </p>
          </div>

          <!-- Controles de vista (opcional para futuro) -->
          <div class="view-controls d-none d-md-flex gap-2">
            <button class="btn btn-sm btn-outline-light active">
              <i class="bi bi-grid-3x3-gap"></i>
            </button>
            <button class="btn btn-sm btn-outline-light">
              <i class="bi bi-list"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Grid de productos mejorado -->
      <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xl-4 g-4">
        <div class="col" *ngFor="let product of products">
          <div class="product-card h-100">

            <!-- Badge de categorÃ­a -->
            @if (product.categoria) {
              <div class="category-badge">
                <i class="bi bi-tag-fill me-1"></i>
                {{ product.categoria }}
              </div>
            }

            <!-- Imagen del producto -->
            <div class="product-image-wrapper">
              <ng-container *ngIf="product.foto && product.foto !== 'NOT-IMAGE'; else noImage">
                <img
                  [src]="product.foto"
                  [alt]="product.descripcion"
                  class="product-image">
              </ng-container>
              <ng-template #noImage>
                <div class="no-image-placeholder">
                  <i class="bi bi-image"></i>
                  <span>Sin imagen</span>
                </div>
              </ng-template>

              <!-- Quick view button (hover) -->
              <div class="product-overlay">
                <button class="btn btn-sm btn-light rounded-pill">
                  <i class="bi bi-eye me-1"></i>
                  Vista rÃ¡pida
                </button>
              </div>
            </div>

            <!-- Contenido del producto -->
            <div class="product-body">

              <!-- TÃ­tulo y cÃ³digo -->
              <div class="product-header mb-3">
                <h5 class="product-title mb-2">
                  {{ product.descripcion }}
                </h5>
                @if (product.codigo) {
                  <span class="product-code">
                    <i class="bi bi-upc-scan me-1"></i>
                    {{ product.codigo }}
                  </span>
                }
              </div>

              <!-- Precio destacado -->
              <div class="product-price-section mb-3">
                @if (isDistribuidor) {
                  <div class="price-wrapper">
                    <span class="price-label">Precio mayorista</span>
                    <span class="price-value">${{ product.precioMayorista }}</span>
                  </div>
                } @else {
                  <div class="price-wrapper">
                    <span class="price-label">Precio</span>
                    <span class="price-value">{{ product.pvp | currency:'USD' }}</span>
                  </div>
                }
              </div>

              <!-- Acciones del producto -->
              <div class="product-actions">
                <div class="quantity-selector">
                  <button
                    class="btn btn-sm btn-outline-secondary"
                    (click)="decrementQuantity(product)">
                    <i class="bi bi-dash"></i>
                  </button>
                  <input
                    type="number"
                    class="form-control form-control-sm text-center"
                    min="1"
                    [(ngModel)]="product.cantidad"
                    [ngModelOptions]="{standalone: true}">
                  <button
                    class="btn btn-sm btn-outline-secondary"
                    (click)="incrementQuantity(product)">
                    <i class="bi bi-plus"></i>
                  </button>
                </div>

                <button
                  class="btn btn-primary w-100 d-flex align-items-center justify-content-center gap-2"
                  (click)="addToCart(product)">
                  <i class="bi bi-cart-plus-fill"></i>
                  <span>Agregar</span>
                </button>
              </div>

            </div>
          </div>
        </div>
      </div>

      <!-- PaginaciÃ³n mejorada -->
      <div class="pagination-wrapper mt-5">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
          <div class="pagination-info">
            <span class="text-white">
              PÃ¡gina <strong>{{ currentPage }}</strong> de <strong>{{ totalPages }}</strong>
            </span>
          </div>

          <nav aria-label="PaginaciÃ³n de productos">
            <ul class="pagination mb-0">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <button
                  class="page-link"
                  (click)="onPreviousPage()"
                  [disabled]="currentPage === 1">
                  <i class="bi bi-chevron-left"></i>
                  <span class="d-none d-sm-inline ms-1">Anterior</span>
                </button>
              </li>

              <!-- NÃºmeros de pÃ¡gina (simplificado) -->
              <li class="page-item active d-none d-md-block">
                <span class="page-link">{{ currentPage }}</span>
              </li>

              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <button
                  class="page-link"
                  (click)="onNextPage()"
                  [disabled]="currentPage === totalPages">
                  <span class="d-none d-sm-inline me-1">Siguiente</span>
                  <i class="bi bi-chevron-right"></i>
                </button>
              </li>
            </ul>
          </nav>
        </div>
      </div>

    </section>
  </div>
</div>

<!-- Footer -->
<footer class="store-footer text-center py-4 mt-5">
  <div class="container">
    <p class="text-white-50 mb-0">
      Developed by <strong class="brand-purple">SwiFtÂ©</strong> 2025
    </p>
  </div>
</footer>
<!-- MODAL PARA SELECCIÃ“N DE VALOR -->
<div class="modal fade" id="resistorModal" tabindex="-1" aria-labelledby="resistorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white" style="border-radius: 12px;">
      <div class="modal-header">
        <h5 class="modal-title" id="resistorModalLabel">Selecciona el valor de resistencia</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <label class="form-label">Valor disponible:</label>
        <select class="form-select" [(ngModel)]="selectedValue">
          <option disabled selected value="">-- Selecciona un valor --</option>
          <option *ngFor="let value of resistorValues" [value]="value">{{ value }}</option>
        </select>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button class="btn btn-primary" (click)="confirmAddResistor()">Agregar al carrito</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="ledModal" tabindex="-1" aria-labelledby="ledModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title" id="ledModalLabel">Seleccionar tipo de LED</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <select [(ngModel)]="selectedValue" class="form-select">
          <option value="" disabled selected>Selecciona color del LED</option>
          <option value="Rojo">Rojo</option>
          <option value="Verde">Verde</option>
          <option value="Azul">Azul</option>
          <option value="Amarillo">Amarillo</option>
          <option value="Blanco">Blanco</option>
        </select>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-light" (click)="confirmAddLed()">Agregar al carrito</button>
      </div>
    </div>
  </div>
</div>
